<!doctype html>
<!--
TiendaCamisetas_Bootstrap.html
Single-file demo: página con sistema simple de gestión de contenido (CMS) para camisetas
- Interfaz con Bootstrap
- Añadir / Editar / Borrar productos (almacenados en localStorage)
- Variaciones: color (muestras) y tallas
- Galería de imágenes (subida a DataURL)
- Carrito de compras simple (localStorage)

Instrucciones rápidas:
1) Guardar este archivo como `TiendaCamisetas_Bootstrap.html`.
2) Abrirlo directamente en el navegador o servir con `python -m http.server 8000` y navegar a http://localhost:8000.
3) Añadir productos desde "Administrar productos" -> "Añadir producto".

Nota: esto es un CMS local (frontend). Para producción necesitarás un backend (Node/Express, base de datos) y subir imágenes a almacenamiento (S3, Cloudinary, etc.).
-->
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Tienda de Camisetas — Demo CMS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .swatch { width: 28px; height: 28px; display:inline-block; border-radius:4px; border:1px solid #ccc; cursor:pointer; }
    .product-image { max-width:100%; height:200px; object-fit:cover; }
    .pointer { cursor:pointer; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Tienda Camisetas</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link active" href="#" id="nav-store">Tienda</a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="nav-admin">Administrar productos</a></li>
      </ul>
      <button class="btn btn-outline-light me-2" id="btn-cart">Carrito (<span id="cart-count">0</span>)</button>
    </div>
  </div>
</nav>

<div class="container my-4" id="view-store">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Tienda</h2>
    <input class="form-control w-25" id="search" placeholder="Buscar...">
  </div>
  <div class="row" id="products-list">
    <!-- productos renderizados aquí -->
  </div>
</div>

<div class="container my-4 d-none" id="view-admin">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Administrar productos</h2>
    <div>
      <button class="btn btn-primary" id="btn-add-product">Añadir producto</button>
      <button class="btn btn-secondary" id="btn-load-sample">Cargar ejemplo</button>
    </div>
  </div>
  <div id="admin-list" class="row">
    <!-- lista admin -->
  </div>
</div>

<!-- Modal Formulario Producto -->
<div class="modal fade" id="productModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productModalLabel">Añadir producto</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="product-form">
          <input type="hidden" id="product-id">
          <div class="mb-3">
            <label class="form-label">Título</label>
            <input class="form-control" id="title" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Descripción</label>
            <textarea class="form-control" id="description"></textarea>
          </div>
          <div class="mb-3 row">
            <div class="col">
              <label class="form-label">Precio (€)</label>
              <input type="number" step="0.01" class="form-control" id="price" required>
            </div>
            <div class="col">
              <label class="form-label">Stock base (opcional)</label>
              <input type="number" class="form-control" id="stock">
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Colores (separados por comas, hex o nombre)</label>
            <input class="form-control" id="colors" placeholder="#000,#fff,red">
          </div>

          <div class="mb-3">
            <label class="form-label">Tallas (separadas por comas)</label>
            <input class="form-control" id="sizes" placeholder="S,M,L,XL">
          </div>

          <div class="mb-3">
            <label class="form-label">Imagen (archivo local). Si no subes nada, usa URL en "Imagen URL".</label>
            <input type="file" class="form-control" id="image-file" accept="image/*">
          </div>

          <div class="mb-3">
            <label class="form-label">Imagen URL (opcional)</label>
            <input class="form-control" id="image-url" placeholder="https://...">
          </div>

          <div class="form-text">Las imágenes cargadas se almacenan en localStorage como DataURL (demo). En producción, sube a un servidor/servicio de almacenamiento.</div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn btn-primary" id="save-product">Guardar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Carrito -->
<div class="modal fade" id="cartModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Carrito</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body" id="cart-body"></div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button class="btn btn-success" id="checkout">Finalizar compra (demo)</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// CMS cliente: usa localStorage para persistencia
const STORAGE_KEY = 'productos_v1';
const CART_KEY = 'carrito_v1';

let products = [];
let cart = [];

// Utilidades
function uid() { return '_' + Math.random().toString(36).slice(2,9); }
function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(products)); }
function load() { products = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); updateCartCount(); }
function loadCart(){ cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]'); updateCartCount(); }
function updateCartCount(){ document.getElementById('cart-count').textContent = cart.reduce((s,i)=>s+i.qty,0); }

// Render tienda
function renderProducts(filter=''){
  const container = document.getElementById('products-list'); container.innerHTML='';
  const q = filter.trim().toLowerCase();
  products.filter(p=> !q || p.title.toLowerCase().includes(q) || (p.description||'').toLowerCase().includes(q))
    .forEach(p=>{
      const col = document.createElement('div'); col.className='col-md-4 mb-4';
      col.innerHTML = `
        <div class="card h-100">
          <img src="${p.image || 'https://via.placeholder.com/400x200?text=Sin+imagen'}" class="card-img-top product-image" alt="${p.title}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">${p.title}</h5>
            <p class="card-text flex-grow-1">${(p.description||'').slice(0,120)}</p>
            <div class="mb-2">Precio: €${Number(p.price).toFixed(2)}</div>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                ${p.colors ? p.colors.slice(0,5).map(c=>`<span class="swatch" title="${c}" style="background:${c}"></span>`).join(' ') : ''}
              </div>
              <div>
                <button class="btn btn-sm btn-outline-primary" onclick="openProduct('${p.id}')">Ver</button>
              </div>
            </div>
          </div>
        </div>`;
      container.appendChild(col);
  });
}

// Render admin list
function renderAdmin(){
  const container = document.getElementById('admin-list'); container.innerHTML='';
  products.forEach(p=>{
    const col = document.createElement('div'); col.className='col-md-6 mb-3';
    col.innerHTML = `
      <div class="card">
        <div class="row g-0">
          <div class="col-4"><img src="${p.image||'https://via.placeholder.com/200x200?text=No+image'}" class="img-fluid" style="height:100%;object-fit:cover"></div>
          <div class="col-8">
            <div class="card-body">
              <h5 class="card-title">${p.title}</h5>
              <p class="card-text">€${Number(p.price).toFixed(2)}</p>
              <button class="btn btn-sm btn-primary me-2" onclick="editProduct('${p.id}')">Editar</button>
              <button class="btn btn-sm btn-danger" onclick="deleteProduct('${p.id}')">Borrar</button>
            </div>
          </div>
        </div>
      </div>`;
    container.appendChild(col);
  });
}

// Añadir / Editar producto
async function addOrUpdateProduct(){
  const id = document.getElementById('product-id').value || uid();
  const title = document.getElementById('title').value.trim();
  const description = document.getElementById('description').value.trim();
  const price = parseFloat(document.getElementById('price').value) || 0;
  const stock = parseInt(document.getElementById('stock').value) || 0;
  const colors = (document.getElementById('colors').value || '').split(',').map(s=>s.trim()).filter(Boolean);
  const sizes = (document.getElementById('sizes').value || '').split(',').map(s=>s.trim()).filter(Boolean);
  const imageUrl = document.getElementById('image-url').value.trim();

  // imagen desde archivo
  const fileInput = document.getElementById('image-file');
  let imageData = '';
  if(fileInput.files && fileInput.files[0]){
    imageData = await toDataURL(fileInput.files[0]);
  }

  const product = { id, title, description, price, stock, colors, sizes, image: imageData || imageUrl };
  const idx = products.findIndex(p=>p.id===id);
  if(idx>=0) products[idx] = product; else products.unshift(product);
  save(); renderProducts(document.getElementById('search').value);
  renderAdmin();
}

function toDataURL(file){
  return new Promise((res,rej)=>{
    const reader = new FileReader();
    reader.onload = e=>res(e.target.result);
    reader.onerror = e=>rej(e);
    reader.readAsDataURL(file);
  });
}

function editProduct(id){
  const p = products.find(x=>x.id===id); if(!p) return;
  document.getElementById('product-id').value = p.id;
  document.getElementById('title').value = p.title;
  document.getElementById('description').value = p.description;
  document.getElementById('price').value = p.price;
  document.getElementById('stock').value = p.stock;
  document.getElementById('colors').value = p.colors.join(',');
  document.getElementById('sizes').value = p.sizes.join(',');
  document.getElementById('image-url').value = p.image || '';
  const modal = new bootstrap.Modal(document.getElementById('productModal'));
  modal.show();
}

function deleteProduct(id){
  if(!confirm('¿Borrar producto?')) return;
  products = products.filter(p=>p.id!==id); save(); renderAdmin(); renderProducts(document.getElementById('search').value);
}

// Ver producto con selección de color/talla
function openProduct(id){
  const p = products.find(x=>x.id===id); if(!p) return;
  const modalHtml = document.createElement('div');
  modalHtml.innerHTML = `
    <div class="modal fade" id="viewProductModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header"><h5 class="modal-title">${p.title}</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6"><img src="${p.image||'https://via.placeholder.com/400x300?text=No+image'}" class="img-fluid"></div>
              <div class="col-md-6">
                <p>${p.description||''}</p>
                <p>Precio: €${Number(p.price).toFixed(2)}</p>
                <div class="mb-2"><strong>Colores:</strong><div id="color-swatches">${p.colors.map(c=>`<span class=\"swatch me-1\" title=\"${c}\" style=\"background:${c}\" onclick=\"selectColor('${id}','${escapeHtml(c)}')\"></span>`).join('')}</div></div>
                <div class="mb-2"><strong>Tallas:</strong><div id="size-options">${p.sizes.map(s=>`<button class=\"btn btn-outline-secondary btn-sm me-1 mb-1\" onclick=\"selectSize('${id}','${s}')\">${s}</button>`).join('')}</div></div>
                <div class="mb-2">Cantidad: <input type="number" id="qty-${id}" value="1" min="1" style="width:80px;"></div>
                <div><button class="btn btn-success" onclick="addToCart('${id}')">Añadir al carrito</button></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>`;
  document.body.appendChild(modalHtml);
  const modalEl = document.getElementById('viewProductModal');
  const modal = new bootstrap.Modal(modalEl);
  modal.show();

  modalEl.addEventListener('hidden.bs.modal', ()=>{ modalEl.remove(); });
}

function escapeHtml(s){ return s.replace(/'/g,"\\'").replace(/"/g,'\"'); }

// Selecciones simples (no guardadas en servidor)
function selectColor(id,color){ /* opcional: mostrar seleccion */ }
function selectSize(id,size){ /* opcional */ }

function addToCart(id){
  const p = products.find(x=>x.id===id); if(!p) return;
  const qty = parseInt(document.getElementById('qty-'+id).value) || 1;
  // para demo, no variación exacta en key
  const itemIdx = cart.findIndex(i=>i.id===id);
  if(itemIdx>=0) cart[itemIdx].qty += qty; else cart.push({ id:p.id, title:p.title, price:p.price, qty });
  saveCart();
  alert('Añadido al carrito');
}

function showCart(){
  loadCart();
  const body = document.getElementById('cart-body'); body.innerHTML='';
  if(cart.length===0){ body.innerHTML='<p>Carrito vacío</p>'; return; }
  const ul = document.createElement('div');
  cart.forEach((it,idx)=>{
    const row = document.createElement('div'); row.className='d-flex justify-content-between align-items-center mb-2';
    row.innerHTML = `<div>${it.title} x ${it.qty}</div><div>€${(it.price*it.qty).toFixed(2)} <button class=\"btn btn-sm btn-outline-danger ms-2\" onclick=\"removeCartItem(${idx})\">Quitar</button></div>`;
    ul.appendChild(row);
  });
  const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
  const totDiv = document.createElement('div'); totDiv.className='mt-3'; totDiv.innerHTML = `<strong>Total: €${total.toFixed(2)}</strong>`;
  body.appendChild(ul); body.appendChild(totDiv);
}

function removeCartItem(idx){ cart.splice(idx,1); saveCart(); showCart(); }

function checkout(){ alert('Proceso de compra demo — integrar pasarela en producción'); cart=[]; saveCart(); showCart(); }

// eventos UI
window.addEventListener('load', ()=>{
  load(); loadCart(); renderProducts(); renderAdmin();
  document.getElementById('nav-admin').addEventListener('click',(e)=>{ e.preventDefault(); document.getElementById('view-admin').classList.remove('d-none'); document.getElementById('view-store').classList.add('d-none'); });
  document.getElementById('nav-store').addEventListener('click',(e)=>{ e.preventDefault(); document.getElementById('view-admin').classList.add('d-none'); document.getElementById('view-store').classList.remove('d-none'); });
  document.getElementById('btn-add-product').addEventListener('click',()=>{ document.getElementById('product-form').reset(); document.getElementById('product-id').value=''; const modal = new bootstrap.Modal(document.getElementById('productModal')); modal.show(); });
  document.getElementById('save-product').addEventListener('click', async ()=>{ await addOrUpdateProduct(); new bootstrap.Modal(document.getElementById('productModal')).hide(); });
  document.getElementById('btn-cart').addEventListener('click',()=>{ showCart(); new bootstrap.Modal(document.getElementById('cartModal')).show(); });
  document.getElementById('checkout').addEventListener('click',()=>{ checkout(); });
  document.getElementById('search').addEventListener('input',(e)=>renderProducts(e.target.value));
  document.getElementById('btn-load-sample').addEventListener('click', ()=>{
    products = [
      { id: uid(), title:'Camiseta básica blanca', description:'Algodón 100%. Corte unisex.', price:12.99, stock:50, colors:['#ffffff','#000000','#ff0000'], sizes:['S','M','L','XL'], image:'https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=800&q=60' },
      { id: uid(), title:'Camiseta deportiva', description:'Transpirable, ideal para deporte.', price:18.5, stock:30, colors:['#1f77b4','#2ca02c'], sizes:['M','L','XL'], image:'https://images.unsplash.com/photo-1520975928392-1b6b7f12d0ec?auto=format&fit=crop&w=800&q=60' }
    ]; save(); renderAdmin(); renderProducts();
  });
});

// inicialización cart desde modal
function removeCartItem(idx){ cart.splice(idx,1); saveCart(); showCart(); }
function checkout(){ alert('Compra demo: guardar orden en servidor / pasarela en producción'); cart=[]; saveCart(); showCart(); }

</script>
</body>
</html>